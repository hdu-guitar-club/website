# 插件开发

学习如何开发 Nextra 插件来扩展文档功能。

## 插件结构

一个基本的 Nextra 插件结构：

```typescript
// plugins/my-plugin.ts
import type { NextraPlugin } from 'nextra';

const myPlugin: NextraPlugin = {
  name: 'my-plugin',
  
  // 在构建时处理文件
  extendPageData(pageData) {
    // 修改页面数据
    pageData.frontMatter.customField = 'value';
  },
  
  // 添加自定义 webpack 配置
  webpack(config) {
    // 自定义 webpack 配置
    return config;
  },
};

export default myPlugin;
```

## 常见插件类型

### 自定义 Remark 插件

```typescript
// plugins/remark-custom.ts
import { visit } from 'unist-util-visit';

export const remarkCustom = () => {
  return (tree) => {
    visit(tree, 'heading', (node) => {
      // 处理标题节点
      if (node.depth === 1) {
        node.data = {
          ...node.data,
          hProperties: {
            className: 'custom-heading',
          },
        };
      }
    });
  };
};
```

### 自定义 Rehype 插件

```typescript
// plugins/rehype-custom.ts
import { visit } from 'unist-util-visit';

export const rehypeCustom = () => {
  return (tree) => {
    visit(tree, 'element', (node) => {
      // 处理 HTML 元素
      if (node.tagName === 'a') {
        node.properties.target = '_blank';
        node.properties.rel = 'noopener noreferrer';
      }
    });
  };
};
```

## 配置插件

在 `next.config.js` 中配置：

```javascript
const withNextra = require('nextra')({
  theme: 'nextra-theme-docs',
  themeConfig: './theme.config.tsx',
  remarkPlugins: [
    require('./plugins/remark-custom'),
  ],
  rehypePlugins: [
    require('./plugins/rehype-custom'),
  ],
});

module.exports = withNextra();
```

## 插件示例

### 自动生成目录

```typescript
export const remarkToc = () => {
  return (tree, file) => {
    const headings = [];
    
    visit(tree, 'heading', (node) => {
      headings.push({
        depth: node.depth,
        text: toString(node),
      });
    });
    
    file.data.frontMatter.toc = headings;
  };
};
```
