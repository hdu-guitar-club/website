# 性能优化

优化文档站点的加载性能和用户体验。

## 图片优化

### 使用 Next.js Image

```tsx
import Image from 'next/image';

<Image
  src="/images/screenshot.png"
  alt="截图"
  width={800}
  height={600}
  loading="lazy"
/>
```

### 图片压缩

```bash
pnpm add -D sharp
```

## 代码分割

### 动态导入组件

```tsx
import dynamic from 'next/dynamic';

const HeavyComponent = dynamic(
  () => import('@/components/heavy-component'),
  { loading: () => <p>加载中...</p> }
);
```

### 懒加载 MDX 组件

```tsx
const Chart = dynamic(
  () => import('@/components/chart'),
  { ssr: false }
);
```

## 缓存策略

### 静态生成

```typescript
// 默认静态生成
export const dynamic = 'force-static';
```

### 增量静态再生

```typescript
export const revalidate = 3600; // 每小时重新验证
```

## 字体优化

### 使用 next/font

```tsx
import { Inter } from 'next/font/google';

const inter = Inter({
  subsets: ['latin'],
  display: 'swap',
});

export default function Layout({ children }) {
  return (
    <html className={inter.className}>
      <body>{children}</body>
    </html>
  );
}
```

## 性能监控

### Web Vitals

```tsx
// app/layout.tsx
export function reportWebVitals(metric) {
  console.log(metric);
}
```

### 使用 Lighthouse

定期运行 Lighthouse 审计：

```bash
npx lighthouse https://docs.example.com --view
```

## 性能最佳实践

1. **减少 JavaScript 体积**：移除未使用的代码
2. **优化 CSS**：使用 Tailwind CSS 的 purge 功能
3. **预加载关键资源**：使用 `<link rel="preload">`
4. **使用 CDN**：静态资源使用 CDN 分发
5. **启用压缩**：服务器启用 Gzip/Brotli 压缩
